# 磁场可视化 AR 应用

## 项目概述

这是一个使用 RealityKit 和 ARKit 开发的增强现实磁场可视化应用，可以实时采集空间中的磁场数据并在 AR 环境中进行可视化展示。

## 功能特性

### 1. 磁场数据采集
- 使用 iOS 设备内置磁力计实时采集磁场数据
- 结合 ARKit 空间追踪获取精确的 3D 位置信息
- 支持连续采集和单点采集两种模式

### 2. AR 可视化
- **向量箭头模式**: 显示磁场方向和强度的 3D 箭头
- **热力图模式**: 使用颜色编码的球体表示磁场强度
- **粒子模式**: 模拟磁力线效果（未来扩展）

### 3. 交互控制
- 直观的触控界面控制数据采集
- 实时切换可视化模式
- 调整采集间隔和可视化参数

### 4. 数据管理
- 实时显示采集状态和数据统计
- 支持数据导出功能
- 一键清除已采集数据

## 技术架构

### 核心组件

1. **MagneticFieldManager**: 磁场数据管理器
   - 管理 CoreMotion 磁力计和 ARKit 会话
   - 实时获取磁场和位置数据
   - 坐标系转换和数据处理

2. **MagneticFieldDataCollection**: 数据集合管理
   - 存储和管理所有磁场数据点
   - 提供数据统计和分析功能
   - 支持数据的增删改查操作

3. **MagneticFieldVisualizer**: 可视化渲染器
   - 将磁场数据转换为 3D 实体
   - 支持多种可视化模式
   - 颜色映射和几何体生成

4. **ControlPanel**: 用户界面控制面板
   - 提供数据采集控制
   - 可视化模式切换
   - 状态显示和数据管理

### 数据结构

```swift
struct MagneticFieldDataPoint {
    let position: SIMD3<Float>        // 3D空间位置
    let magneticField: SIMD3<Float>   // 磁场向量 (µT)
    let timestamp: Date               // 时间戳
    let fieldStrength: Float          // 磁场强度
}
```

## 使用方法

### 1. 启动应用
- 打开应用后会自动开始磁场追踪
- 确保设备处于良好光照环境以获得最佳 AR 追踪效果

### 2. 数据采集
- 点击"开始采集"按钮进入连续采集模式
- 或使用"添加点"按钮进行单点采集
- 在空间中移动设备以采集不同位置的磁场数据

### 3. 可视化查看
- 采集的数据会实时显示在 AR 场景中
- 使用底部控制面板切换不同的可视化模式
- 向量箭头显示磁场方向，颜色表示强度

### 4. 数据管理
- 查看采集的数据点数量和空间范围
- 使用"导出"功能保存数据
- 使用"清除"功能删除所有数据

## 技术要点

### 坐标系转换
- 设备坐标系 → 世界坐标系转换
- 磁场向量的空间方向对齐
- AR 追踪精度优化

### 可视化算法
- 磁场强度的颜色映射（蓝→绿→红）
- 向量箭头的 3D 旋转计算
- 动态缩放和透明度调整

### 性能优化
- 采集频率控制避免数据过载
- 实体池管理减少内存占用
- 异步渲染提升响应性能

## 扩展功能

### 未来可能的增强
1. **数据分析**: 磁场梯度分析、异常检测
2. **导出格式**: 支持 CSV、JSON 等多种格式
3. **云端同步**: 数据上传和多设备同步
4. **测量工具**: 距离测量、区域分析
5. **预设模式**: 针对特定应用场景的预设配置

## 注意事项

1. **环境要求**: 
   - 需要良好的光照条件进行 AR 追踪
   - 避免强磁场干扰（如扬声器、电器等）

2. **精度限制**:
   - 磁力计精度约为 ±0.1µT
   - AR 追踪精度约为 ±1cm

3. **电量消耗**:
   - 连续使用会消耗较多电量
   - 建议在充电状态下进行长时间采集

## 技术依赖

- iOS 17.0+
- ARKit 支持的设备
- 内置磁力计传感器
- RealityKit 框架
- CoreMotion 框架
